{% extends "question/edit.html" %}
{% load sstatic %}
{% load user_link %}

{% block stylesheets %}
	{{ block.super }}
	<link rel="stylesheet" type="text/css" href="{% sstatic 'css/question/noneditable.css' %}">
{% endblock stylesheets %}

{% block editable_message %}{% endblock editable_message %}

{% block progress %}
Progress: <span data-bind="text: progress()[1], attr: {class: 'progress-display '+progress()[0]}"></span>
{% endblock progress %}

{% block editor %}
	<div class="tab-content">
		<section class="tab-pane" data-bind="css: {active: ko.utils.unwrapObservable($root.currentTab().id)=='general'}">
			<div class="row-fluid section">
				<div class="span8">
					<p><span class="question-author">Question Author:</span> {% user_link object.author %}</p>
					<p class="editable-message">
						You may only view this question. {% if user.is_authenticated %}If you want to change something, make a copy.{% endif %}
					</p>
                    {% if object.copy_of %}
                    <p>This question is based on <a href="{% url 'question_edit' object.copy_of.pk object.copy_of.slug %}">{{object.copy_of.name}}</a> by <a href="{% url 'view_profile' object.copy_of.author.pk %}">{{object.copy_of.author.get_full_name}}</a>.</p>
                    {% endif %}
				</div>
				<div class="span4">

					{% if perms.editor.question_highlight %}
					<a href="{% url 'highlight_question' object.pk object.slug %}">Highlight this question on the front page.</a>
					{% endif %}
				</div>
			</div>
			<div class="row-fluid section">
				<div class="span8">
					<label for="description"><h4>Description</h4></label>
					<div id="description" data-bind="mathjaxHTML: description"></div>
					<div data-bind="if: !description()" class="nothing-here">The author has not written a description.</div>
					<label for="authors-notes"><h4>Author's Notes</h4></label>
					<div id="authors-notes" data-bind="mathjaxHTML: notes"></div>
					<div data-bind="if:!notes()" class="nothing-here">The author has not made any notes.</div>
				</div>
				<div class="span4">
					<h4>Extensions</h4>
					<ul class="extensions" data-bind="foreach: usedExtensions">
						<li class="extension">
							<label>
								<span data-bind="text:name"></span> <a data-bind="attr: {href:url}" target="_blank">(documentation)</a>
							</label>
						</li>
					</ul>
					<div data-bind="if: usedExtensions().length==0" class="nothing-here">This question doesn't use any extensions.</div>
					<div class="tags">
						<h4>Tags</h4>
						<ul class="tags" data-bind="foreach: tags">
							<li class="tag well">
								<a data-bind="attr: {href: '{% url 'question_search' %}?tags='+encodeURIComponent($data), title:'Questions with the tag \''+$data+'\''}, text: $data"></a>
							</li>
						</ul>
						<div class="nothing-here" data-bind="if: tags().length==0">This question does not have any tags.</div>
					</div>
				</div>
			</div>
		</section>
		<section class="tab-pane" data-bind="css: {active: ko.utils.unwrapObservable($root.currentTab().id)=='statement'}">
			<div id="statement" data-bind="mathjaxHTML: statement"></div>
			<div class="nothing-here" data-bind="if:!statement()">No statement.</div>
		</section>
		<section class="tab-pane" data-bind="css: {active: ko.utils.unwrapObservable($root.currentTab().id)=='variables'}">
			<div class="row-fluid">
				<div data-bind="if: variables().length">
					<div class="span4">
						<div>
							<div class="variable-groups" data-bind="foreach: allVariableGroups">
								<div class="variable-group" data-bind="css: {editable: !fixed}">
									<div class="group-name">
										<h4 data-bind="text: displayName"></h4>
									</div>
									<table class="variable-list">
										<thead>
											<tr>
												<th class="name">Name</th>
												<th class="value">Generated Value</th>
											</tr>
										</thead>
										<tbody data-bind="css: {empty: variables().length==0}, foreach: variables">
											<tr data-bind="click: $root.currentVariable, css: {noname: !name(), current: $data==$root.currentVariable(), dependency: isDependency}" class="variable-selector">
												<td class="name" data-bind="text: name() ? name() : 'Unnamed'"></td>
												<td class="value-cell">
													<div class="value" data-bind="css: {error: error().length>0}, html: display"></div>
												</td>
											</tr>
										</tbody>
									</table>
								</div>
							</div>
						</div>
						<button type="button" data-bind="click: computeVariables, visible: variables().length>0">Regenerate values</button>
					</div>
					<div class="span8 variable" data-bind="with: currentVariable">
						<form class="form-horizontal">
							<div class="control-group">
								<label>
									<span class="control-label">
										Name
										<helplink params="url: 'http://numbas-editor.readthedocs.org/en/latest/question-reference.html#term-name'"></helplink>
									</span>
									<div class="controls">
										<code class="name" data-bind="text: name"></code>
										<span class="name-error" data-bind="text: nameError, visible: nameError"></span>
									</div>
								</label>
							</div>
							<div>
								<selectproperty params="
									label: 'Data type',
									property: templateType, 
									options: templateTypes, 
									optionsText: 'name', 
									helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-reference.html#term-data-type'
								"></selectproperty>
							</div>
							<div class="control-group">
								<label class="control-label">
									Value
									<helplink params="url: 'http://numbas-editor.readthedocs.org/en/latest/question-reference.html#term-value'"></helplink>
								</label>

								<div class="controls">
									<div data-bind="visible: templateType().id=='anything'">
										<textarea disabled class="def" data-bind="readOnly: true, valueUpdate: 'afterkeydown', codemirror: templateTypeValues.anything.definition, codemirrorMode: 'jme'"></textarea>
									</div>
									<div data-bind="visible: templateType().id=='number'">
										<span data-bind="text: templateTypeValues.number.value"></span>
									</div>
									<div data-bind="visible: templateType().id=='range'">
										Numbers between 
										<span data-bind="text: templateTypeValues.range.min"></span>
										and
										<span data-bind="text: templateTypeValues.range.max"></span>
										(inclusive) with step size
										<span data-bind="text: templateTypeValues.range.step"></span>
									</div>
									<div data-bind="visible: templateType().id=='randrange'">
										A random number between 
										<span data-bind="text: templateTypeValues.randrange.min"></span>
										and
										<span data-bind="text: templateTypeValues.randrange.max"></span>
										(inclusive) with step size
										<span data-bind="value: templateTypeValues.randrange.step"></span>
									</div>
									<div data-bind="visible: templateType().id=='string'">
										<span data-bind="text: templateTypeValues.string.value"></span>
									</div>
									<div data-bind="visible: templateType().id=='long string'">
										<div data-bind="mathjaxHTML: templateTypeValues['long string'].value"></div>
									</div>
									<div data-bind="visible: templateType().id=='list of numbers', with: templateTypeValues['list of numbers']">
										<span data-bind="text: commaValue"></span>
									</div>
									<div data-bind="visible: templateType().id=='list of strings', with: templateTypeValues['list of strings']">
										<ul class="no-bullets" data-bind="foreach: values.edit">
											<li>
												<span data-bind="text: value"></span>
											</li>
										</ul>
									</div>
								</div>
							</div>
							<div class="control-group" data-bind="if: description">
								<label>
									<span class="control-label">Description</span>
									<div class="controls" data-bind="mathjaxHTML: description"></div>
								</label>
							</div>
						</form>
						<div data-bind="visible: dependencies().length>0" class="inline-names">
							<strong>Depends on:</strong>
							<ul data-bind="foreach: dependenciesObjects">
								<li><!-- ko if: $index()>0 -->, <!-- /ko --><span class="variable" data-bind="click: $root.currentVariable, text: name"></span></li>
							</ul>.
						</div>
						<div data-bind="visible: usedIn().length>0" class="inline-names">
							<strong>Used by:</strong>
							<ul data-bind="foreach: usedIn">
								<li><!-- ko if: $index()>0 -->, <!-- /ko --><span class="variable" data-bind="click: $root.currentVariable, text: name"></span></li>
							</ul>.
						</div>
					</div>
				</div>
			</div>
			<div class="nothing-here" data-bind="if: variables().length==0">
				This question doesn't use any variables.
			</div>
		</section>
		<section class="tab-pane" data-bind="css: {active: ko.utils.unwrapObservable($root.currentTab().id)=='functions'}">
			<div id="functions">
				<h4>Functions</h4>
				<!-- ko foreach: functions -->
				<div class="function row-fluid">
					<div class="span8">
						<div class="row-fluid">
							<div class="span4">
								Name: <span data-bind="text: name"></span>
							</div>
							<div class="span4">
								Language: <span data-bind="text: language"></span>
							</div>
							<div class="span4">
								Output type: <span data-bind="text: type"></span>
							</div>
							<div>
								<label>
									Definition:
									<textarea data-bind="readOnly: true, codemirror: definition, codemirrorMode: language, valueUpdate: 'afterkeydown'"></textarea>
								</label>
								<div class="error" data-bind="visible: error().length>0">
									Error: <span class="errortext" data-bind="html: error"></span>
								</div>
							</div>
						</div>
					</div>
					<div class="span3" data-bind="visible: parameters().length>0">
						<label>Parameters</label>
						<!-- ko foreach: parameters -->
						<div class="row-fluid parameter">
							<code class="name" data-bind="text: name"></code>: <span class="type" data-bind="text: type"></span>
						</div>
						<!-- /ko -->
					</div>
				</div>
				<!-- /ko -->
				<div data-bind="if: functions().length==0" class="nothing-here">
					This question doesn't define any functions.
				</div>
			</div>
			<div id="rulesets">
				<h4>Rulesets</h4>
				<form class="form-horizontal">
					<!-- ko foreach: rulesets -->
						<div class="ruleset control-group">
							<span class="control-label"><code data-bind="text: name"></code></span>
							<div class="controls">:
								<!-- ko foreach: sets -->
								<code class="ruleset" data-bind="text: $data"></code>
								<!-- /ko -->
							</div>
						</div>
					<!-- /ko -->
				</form>
				<div data-bind="if: rulesets().length==0" class="nothing-here">
					This question doesn't define any rulesets.
				</div>
			</div>
			<div id="preamble">
				<h4>
					Preamble
					<helplink params="url: 'http://numbas-editor.readthedocs.org/en/latest/question-reference.html#preamble'"></helplink>
				</h4>
				<form class="form-horizontal">
					<div class="control-group">
						<label class="control-label">
							Javascript
						</label>
						<div class="controls">
							<textarea class="def" data-bind="readOnly: true, valueUpdate: 'afterkeydown', codemirror: preamble.js, codemirrorMode: 'javascript'"></textarea>
						</div>
					</div>
					<div class="control-group">
						<label class="control-label">
							CSS
						</label>
						<div class="controls">
							<textarea class="def" data-bind="readOnly: true, valueUpdate: 'afterkeydown', codemirror: preamble.css, codemirrorMode: 'css'"></textarea>
						</div>
					</div>
				</form>
			</div>
		</section>
		<section class="tab-pane" data-bind="css: {active: ko.utils.unwrapObservable($root.currentTab().id)=='parts'}">
			<div class="row-fluid">
				<div class="span3">
					<ol class="parts nav nav-list" data-bind="foreach: parts">
						<li class="part clearfix" data-bind="css: {active: $root.currentPart()==$data}">
							<a data-bind="text: header, click: $root.showPart" href="#"></a>
							<div class="subparts" data-bind="fadeVisible: meOrChildSelected">
								<div class="gaps" data-bind="visible: type().name=='gapfill' && gapfill.gaps().length>0">
									<h6>Gaps</h6>
									<ol class="gaps nav nav-list" data-bind="foreach: gapfill.gaps">
										<li class="part clearfix" data-bind="css: {active: $root.currentPart()==$data}">
											<a data-bind="text: header, click: $root.showPart" href="#"></a>
										</li>
									</ol>
								</div>
								<div class="steps clearfix" data-bind="visible: steps().length>0">
									<h6>Steps</h6>
									<ol class="steps nav nav-list" data-bind="foreach: steps">
										<li class="part clearfix" data-bind="css: {active: $root.currentPart()==$data}">
											<a data-bind="text: header, click: $root.showPart" href="#"></a>
										</li>
									</ol>
								</div>
							</div>
						</li>
					</ol>
				</div>
				<div class="span9 part-edit" data-bind="with: currentPart">
					<div class="row-fluid">
						<ul class="nav nav-tabs" data-bind="foreach: tabs">
							<li data-bind="css: {active: ko.utils.unwrapObservable($parent.currentTab().id) == $data.id}">
								<a href="#" data-bind="click: $parent.currentTab, text: title"></a>
							</li>
						</ul>
					</div>
					<div class="row-fluid">
						<div class="tab-content">
							<section class="tab-pane" data-bind="css: {active: ko.utils.unwrapObservable(currentTab().id)=='prompt'}">
								<div data-bind="mathjaxHTML: prompt"></div>
								<div data-bind="if: !prompt()" class="nothing-here">No prompt.</div>
							</section>
							<!-- ko if: type().name=='gapfill' -->
							<section class="tab-pane" data-bind="css: {active: ko.utils.unwrapObservable(currentTab().id)=='marking'}">
								<form class="form-horizontal">
									<property params="
												label: 'Penalty for revealing steps',
												value: stepsPenalty,
												min: 0,
												helpUrl: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-penalty-for-revealing-steps'
									"></property>
								</form>
							</section>
							<!-- /ko -->
							<!-- ko if: type().name=='jme' -->
							<section class="tab-pane" data-bind="css: {active: ko.utils.unwrapObservable(currentTab().id)=='marking'}">
								<form class="form-horizontal">
									<property params="
										label:'Marks',
										value: marks,
										min:0, 
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-marks'
									"></property>
									<property data-bind="visible: !parent" params="
										label:'Penalty for revealing steps',
										value: stepsPenalty,
										min:0, 
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-penalty-for-revealing-steps'
									"></property>
									<div class="control-group">
										<label>
											<span class="control-label">Correct answer <helplink params="url: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-correct-answer'"></helplink></span>
											<div class="controls">
												<input class="monospace" type="text" data-bind="textInput: jme.answer, autosize: {max: 500, min: 30, padding: 10, value: jme.answer}"/>
												<span data-bind="JME: jme.answer" class="jme-answer"></span>
											</div>
										</label>
									</div>
									<booleanproperty params="
										label: 'Show correct answer on reveal?',
										value: showCorrectAnswer,
										min:0, 
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-show-correct-answer-on-reveal'
									"></booleanproperty>
									<booleanproperty params="
										label: 'Show preview of student\'s answer?', 
										value: jme.showPreview, 
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-show-preview-of-student-s-answer'
									"></booleanproperty>
									<property params="
										label: 'Answer simplification rules',
										value: jme.answerSimplification, 
										monospace: true, 
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-answer-simplification-rules'
									"></property>
								</form>
							</section>
							<section class="tab-pane" data-bind="css: {active: ko.utils.unwrapObservable(currentTab().id)=='restrictions'}">
								<form class="form-horizontal">
									<h4>Checking accuracy</h4>
									<selectproperty params="
										label: 'Checking type',
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-checking-type',
										options: jme.checkingTypes,
										value: jme.checkingType,
										optionsText: 'niceName'
									"></selectproperty>
									<property params="
										label: 'Checking accuracy',
										value: jme.checkingType().accuracy,
										min: 0,
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-checking-accuracy'
									"></property>
									<property params="
										label: 'Points to check',
										value: jme.vset.points,
										min:0, 
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-points-to-check'
									"></property>
									<property params="
										label: 'Maximum no. of failures',
										value: jme.failureRate,
										min:0, 
										max:jme.vset.points, 
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-maximum-no-of-failures'
									"></property>
									<property params="
										label: 'Checking range start',
										value :jme.vset.start,
										max: jme.vset.end, 
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-checking-range-start'
									"></property>
									<property params="
										label: 'Checking range end',
										value: jme.vset.end,
										min:jme.vset.start, 
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-checking-range-end'
									"></property>
								</form>
								<h4>Length restriction</h4>
								<form class="form-horizontal">
									<div class="control-group" data-bind="template: {
										name: 'property',
										data: {label:'Maximum length',property:jme.maxlength.length,min:0}
									}"></div>
									<div data-bind="fadeVisible: jme.maxlength.length()>0">
										<div class="control-group" data-bind="template: {
											name:'percentproperty',
											data: {label:'Partial credit for long answer',property:jme.maxlength.partialCredit}
										}"></div>
										<div class="control-group">
											<label>
												<span class="control-label">Warning message</span>
												<div class="controls" data-bind="mathjaxHTML: jme.maxlength.message"></div>
											</label>
										</div>
									</div>
								</form>
								<form class="form-horizontal">
									<div class="control-group" data-bind="template: {
										name: 'property',
										data: {label:'Minimum length',property:jme.minlength.length,min:0}
									}"></div>
									<div data-bind="fadeVisible: jme.minlength.length()>0">
										<div class="control-group" data-bind="template: {
											name:'percentproperty',
											data: {label:'Partial credit for short answer',property:jme.minlength.partialCredit}
										}"></div>
										<div class="control-group">
											<label>
												<span class="control-label">Warning message</span>
												<div class="controls" data-bind="mathjaxHTML: jme.minlength.message"></div>
											</label>
										</div>
									</div>
								</form>
								<h4>String restriction</h4>
								<form class="form-horizontal">
									<div class="control-group">
										<label>
											<span class="control-label">Required strings:</span>
											<div class="controls">
												<!-- ko foreach: jme.musthave.strings-->
												<span class="well well-small" data-bind="text: $data"></span >
												<!-- /ko -->
											</div>
										</label>
									</div>
									<div data-bind="fadeVisible: jme.musthave.strings().length>0">
										<div class="control-group" data-bind="template: {
											name:'percentproperty',
											data: {label:'Partial credit for not using all required strings:',property:jme.musthave.partialCredit}
										}"></div>
										<div class="control-group" data-bind="template: {
											name: 'booleanproperty',
											data: {label:'Show required strings in warning?', property:jme.musthave.showStrings}
										}"></div>
										<div class="control-group">
											<label>
												<span class="control-label">Warning message</span>
												<div class="controls" data-bind="mathjaxHTML: jme.musthave.message"></div>
											</label>
										</div>
									</div>
								</form>

								<form class="form-horizontal">
									<div class="control-group">
										<label>
											<span class="control-label">Forbidden strings:</span>
											<div class="controls">
												<!-- ko foreach: jme.notallowed.strings-->
												<span class="well well-small" data-bind="text: $data"></span >
												<!-- /ko -->
											</div>
										</label>
									</div>
									<div data-bind="fadeVisible: jme.notallowed.strings().length>0">
										<div class="control-group" data-bind="template: {
											name:'percentproperty',
											data: {label:'Partial credit for not using all required strings:',property:jme.notallowed.partialCredit}
										}"></div>
										<div class="control-group" data-bind="template: {
											name: 'booleanproperty',
											data: {label:'Show required strings in warning?', property:jme.notallowed.showStrings}
										}"></div>
										<div class="control-group">
											<label>
												<span class="control-label">Warning message</span>
												<div class="controls" data-bind="mathjaxHTML: jme.notallowed.message"></div>
											</label>
										</div>
									</div>
								</form>

								<form class="form-horizontal">
                                    <div class="control-group" data-bind="template: {
                                        name: 'booleanproperty',
                                        data: {label: 'Warn if student uses an unexpected variable name?', property:jme.checkVariableNames}
                                    }"></div>
									<div class="control-group" data-bind="fadeVisible:jme.checkVariableNames">
										<label>
											<span class="control-label">Expected variable names:</span>
											<div class="controls">
												<!-- ko foreach: jme.expectedVariableNames -->
												<span class="well well-small" data-bind="text: $data"></span >
												<!-- /ko -->
											</div>
										</label>
									</div>
								</form>
							</section>
							<!-- /ko -->
							<!-- ko if: type().name=='numberentry' -->
							<section class="tab-pane" data-bind="css: {active: ko.utils.unwrapObservable(currentTab().id)=='marking'}">
								<form class="form-horizontal">
									<div class="control-group" data-bind="template: {
										name: 'property',
										data: {label:'Marks',property:marks,min:0}
									}"></div>
									<div class="control-group" data-bind="template: {
										name: 'property',
										data: {label:'Penalty for revealing steps',property:stepsPenalty,min:0}
									}"></div>
									<div class="control-group" data-bind="template: {
										name: 'property',
										data: {label:'Minimum accepted value',property:numberentry.minValue}
									}"></div>
									<div class="control-group" data-bind="template: {
										name: 'property',
										data: {label:'Maximum accepted value',property:numberentry.maxValue}
									}"></div>
									<div class="control-group" data-bind="template: {
										name: 'booleanproperty',
										data: {label:'Must the answer be an integer?', property:numberentry.integerAnswer}
									}"></div>
									<div class="control-group" data-bind="fadeVisible: numberentry.integerAnswer,
									template: {
										name:'percentproperty',
										data: {label:'Partial credit for non-integer answer',property:numberentry.integerPartialCredit}
									}"></div>
									<div class="control-group">
										<label>
											<span class="control-label">Precision restriction</span>
											<div class="controls">
												<span data-bind="text:numberentry.precisionType().niceName"></span>
											</div>
										</label>
									</div>
									<div class="control-group" data-bind="fadeVisible: numberentry.precisionType().name!='none',
									template: {
										name:'property',
										data: {label:numberentry.precisionWord,property:numberentry.precision}
									}"></div>
									<div class="control-group" data-bind="fadeVisible: numberentry.precisionType().name!='none',
									template: {
										name:'booleanproperty',
										data: {label:'Require trailing zeroes?',property:numberentry.strictPrecision}
									}"></div>
									<div class="control-group" data-bind="fadeVisible: numberentry.precisionType().name!='none',
									template: {
										name:'percentproperty',
										data: {label:'Partial credit for wrong precision',property:numberentry.precisionPartialCredit}
									}"></div>
									<div class="control-group" data-bind="fadeVisible: numberentry.precisionType().name!='none'">
										<label>
											<span class="control-label">Message if wrong precision</span>
											<div class="controls" data-bind="mathjaxHTML: numberentry.precisionMessage"></div>
										</label>
									</div>
								</form>
							</section>
							<!-- /ko -->
							<!-- ko if: type().name=='patternmatch' -->
							<section class="tab-pane" data-bind="css: {active: ko.utils.unwrapObservable(currentTab().id)=='marking'}">
								<form class="form-horizontal">
									<div class="control-group" data-bind="template: {
										name: 'property',
										data: {label:'Marks',property:marks,min:0}
									}"></div>
									<div class="control-group" data-bind="template: {
										name: 'property',
										data: {label:'Penalty for revealing steps',property:stepsPenalty,min:0}
									}"></div>
									<div class="control-group " data-bind="template: {
										name: 'property',
										data: {label:'Answer pattern',property:patternmatch.answer, monospace: true}
									}"></div>
									<div class="control-group" data-bind="template: {
										name: 'property',
										data: {label:'Display answer',property:patternmatch.displayAnswer}
									}"></div>
									<div class="control-group" data-bind="template: {
										name: 'booleanproperty',
										data: {label:'Must the answer be in the correct case?', property:patternmatch.caseSensitive}
									}"></div>
									<div class="control-group" data-bind="
									fadeVisible:patternmatch.caseSensitive,
									template: {
										name:'percentproperty',
										data: {label:'Partial credit for answer not matching case',property:patternmatch.partialCredit}
									}"></div>
								</form>
							</section>
							<!-- /ko -->
							<!-- ko if: type().name=='1_n_2' -->
							<section class="tab-pane" data-bind="css: {active: ko.utils.unwrapObservable(currentTab().id)=='marking'}">
								<form class="form-horizontal">
									<div class="control-group" data-bind="template: {
										name: 'property',
										data: {label:'Minimum marks',property:multiplechoice.minMarks, max:multiplechoice.maxMarks }
									}"></div>
									<div class="control-group" data-bind="template: {
										name: 'property',
										data: {label:'Maximum marks',property:multiplechoice.maxMarks, min:multiplechoice.minMarks}
									}"></div>
									<div class="control-group" data-bind="template: {
										name: 'property',
										data: {label:'Penalty for revealing steps',property:stepsPenalty,min:0}
									}"></div>
									<div class="control-group" data-bind="template: {
										name: 'booleanproperty',
										data: {label:'Shuffle order of choices?', property:multiplechoice.shuffleChoices}
									}"></div>
									<div class="control-group" data-bind="fadeVisible: multiplechoice.displayType().name!='dropdown',
									template: {
										name: 'property',
										data: {label:'Number of display columns',property:multiplechoice.displayColumns}
									}"></div>
									<div class="control-group" data-bind="template: {
										name: 'booleanproperty',
										data: {label: 'Custom marking matrix?', property: multiplechoice.customMarking}
									}"></div>
									<div class="control-group" data-bind="fadeVisible: multiplechoice.customMarking, template: {
										name: 'property',
										data: {label: 'Custom matrix expression', property: multiplechoice.customMatrix, monospace: true}
									}"></div>
								</form>
							</section>
							<section class="tab-pane" data-bind="css: {active: ko.utils.unwrapObservable(currentTab().id)=='choices'}">
								<ol class="choices">
									<!-- ko foreach: {data: multiplechoice.choices, afterAdd: Editor.afterAdd} -->
									<li class="choice">
										<form class="form-inline">
											<div class="choice-bits">
												<label>
													Marks:
													<span class="marks" data-bind="text: marks"></span>
												</label>
												<label data-bind="if: distractor">
													Distractor Message:
													<span class="distractor" data-bind="text: distractor"></span>
												</label>
											</div>
											<div id="description" data-bind="mathjaxHTML: content, wmHeight: 100, wmWidth: 500"></div>
										</form>
									</li>
									<!-- /ko -->
								</ol>
							</section>
							<!-- /ko -->
							<!-- ko if: type().name=='m_n_2' -->
							<section class="tab-pane" data-bind="css: {active: ko.utils.unwrapObservable(currentTab().id)=='marking'}">
								<form class="form-horizontal">
									<div class="control-group" data-bind="template: {
										name: 'property',
										data: {label:'Minimum marks',property:multiplechoice.minMarks, max:multiplechoice.maxMarks }
									}"></div>
									<div class="control-group" data-bind="template: {
										name: 'property',
										data: {label:'Maximum marks',property:multiplechoice.maxMarks, min:multiplechoice.minMarks}
									}"></div>
									<div class="control-group" data-bind="template: {
										name: 'property',
										data: {label:'Penalty for revealing steps',property:stepsPenalty,min:0}
									}"></div>
									<div class="control-group" data-bind="template: {
										name: 'property',
										data: {label:'Minimum answers:',property:multiplechoice.minAnswers, max:multiplechoice.maxAnswers}
									}"></div>
									<div class="control-group" data-bind="template: {
										name: 'property',
										data: {label:'Maximum answers:',property:multiplechoice.maxAnswers, min:multiplechoice.minAnswers}
									}"></div>
									<div class="control-group" data-bind="template: {
										name: 'booleanproperty',
										data: {label:'Shuffle order of choices?', property:multiplechoice.shuffleChoices}
									}"></div>
									<div class="control-group" data-bind="fadeVisible: multiplechoice.displayType().name!='dropdown',
									template: {
										name: 'property',
										data: {label:'Number of display columns',property:multiplechoice.displayColumns}
									}"></div>
									<div class="control-group" data-bind="template: {
										name: 'booleanproperty',
										data: {label: 'Custom marking matrix?', property: multiplechoice.customMarking}
									}"></div>
									<div class="control-group" data-bind="fadeVisible: multiplechoice.customMarking, template: {
										name: 'property',
										data: {label: 'Custom matrix expression', property: multiplechoice.customMatrix, monospace: true}
									}"></div>
								</form>
							</section>
							<section class="tab-pane" data-bind="css: {active: ko.utils.unwrapObservable(currentTab().id)=='choices'}">
								<ul class="choices">
									<!-- ko foreach: {data: multiplechoice.choices, afterAdd: Editor.afterAdd} -->
									<li class="choice">
										<form class="form-inline">
											<label>
												Marks:
												<span class="marks" data-bind="text: marks"></span>
											</label>
											<label>
												Distractor Message:
												<span class="distractor" data-bind="texr: distractor"></span>
											</label>
											<div id="description" data-bind="mathjaxHTML: content, wmHeight: 100, wmWidth: 500"></div>
										</form>
									</li>
									<!-- /ko -->
								</ul>
							</section>
							<!-- /ko -->
							<!-- ko if: type().name=='m_n_x' -->
							<section class="tab-pane" data-bind="css: {active: ko.utils.unwrapObservable(currentTab().id)=='marking'}">
								<form class="form-horizontal">
									<div class="control-group" data-bind="template: {
										name: 'property',
										data: {label:'Minimum marks',property:multiplechoice.minMarks, max:multiplechoice.maxMarks }
									}"></div>
									<div class="control-group" data-bind="template: {
										name: 'property',
										data: {label:'Maximum marks',property:multiplechoice.maxMarks, min:multiplechoice.minMarks}
									}"></div>
									<div class="control-group" data-bind="template: {
										name: 'property',
										data: {label:'Penalty for revealing steps',property:stepsPenalty,min:0}
									}"></div>
									<div class="control-group" data-bind="template: {
										name: 'property',
										data: {label:'Minimum answers:',property:multiplechoice.minAnswers, max:multiplechoice.maxAnswers}
									}"></div>
									<div class="control-group" data-bind="template: {
										name: 'property',
										data: {label:'Maximum answers:',property:multiplechoice.maxAnswers, min:multiplechoice.minAnswers}
									}"></div>
									<div class="control-group" data-bind="template: {
										name: 'booleanproperty',
										data: {label:'Shuffle order of choices?', property:multiplechoice.shuffleChoices}
									}"></div>
									<div class="control-group" data-bind="template: {
										name: 'booleanproperty',
										data: {label:'Shuffle order of answers?', property:multiplechoice.shuffleAnswers}
									}"></div>
									<div class="control-group">
										<label>
											<span class="control-label">Selection type:</span>
											<div class="controls">
												<span data-bind="text:multiplechoice.displayType().niceName"></span>
											</div>
										</label>
									</div>
									<div class="control-group" data-bind="template: {
										name: 'booleanproperty',
										data: {label: 'Custom marking matrix?', property: multiplechoice.customMarking}
									}"></div>
									<div class="control-group" data-bind="fadeVisible: multiplechoice.customMarking, template: {
										name: 'property',
										data: {label: 'Custom matrix expression', property: multiplechoice.customMatrix, monospace: true}
									}"></div>
								</form>
							</section>
							<section class="tab-pane" data-bind="css: {active: ko.utils.unwrapObservable(currentTab().id)=='choices'}">
								<div class="matrix">
									<label>Marking matrix:</label>
									<table class="multiplechoice">
										<thead>
											<tr>
												<td></td>
												<!-- ko foreach: {data: multiplechoice.answers, afterAdd: Editor.afterAdd} -->
													<th class="answer" data-bind="html:content"></th>
												<!-- /ko -->
											</tr>
										</thead>
										<tbody>
											<!-- ko foreach: {data: multiplechoice.choices, afterAdd: Editor.afterAdd} -->
												<tr>
													<th class="choice" data-bind="html:content"></th>
													<!-- ko foreach: answers -->
													<td class="marks monospace" data-bind="text: marks"></td>
													<!-- /ko -->
												</tr>
											<!-- /ko -->
										</tbody>
									</table>
								</div>
							</section>
							<!-- /ko -->
							<section class="tab-pane" data-bind="css: {active: ko.utils.unwrapObservable(currentTab().id)=='scripts'}">
								<form class="form-horizontal" data-bind="foreach: scripts">
									<div class="control-group">
										<label class="control-label">
											<span data-bind="text: displayName"></span><span data-bind="if: active"> (active)</span>
										</label>
										<div class="controls">
											<div data-bind="visible: active">
												<textarea data-bind="readOnly: true, valueUpdate: 'afterkeydown', codemirror: script, codemirrorMode: 'javascript'"></textarea>
											</div>
											<span data-bind="visible: !active()" class="nothing-here">Not used</span>
										</div>
									</div>
								</form>
							</section>
						</div>
					</div>
				</div>
			</div>
		</section>
		<section class="tab-pane" data-bind="css: {active: ko.utils.unwrapObservable($root.currentTab().id)=='advice'}">
			<div data-bind="mathjaxHTML: advice"></div>
		</section>
		<section class="tab-pane" data-bind="css: {active: ko.utils.unwrapObservable($root.currentTab().id)=='resources'}">
			<ul class="unstyled resources-list" data-bind="foreach: resources">
				<li class="resource clearfix"><img class="thumbnail" data-bind="attr: {src: url, title: name}"/><span data-bind="text: name"></span></li>
			</ul>
		</section>
		<section class="tab-pane" data-bind="css: {active: ko.utils.unwrapObservable($root.currentTab().id)=='exams'}">
			{% if object.exam_set.count %}
				<ul class="exams-list">
				{% for exam in object.exam_set.all %}
					<li class="exam">
						<a href="{% url 'exam_edit' exam.pk exam.slug %}">{{exam.name}}</a> ({{ exam.author.get_full_name }})
					</li>
				{% endfor %}
				</ul>
			{% else %}
				This question is not used in any exams.
			{% endif %}
		</section>
	</div>

{% endblock editor %}

{% block ko_components %}
	{{ block.super }}
	{% include "noneditable-components.html" %}
{% endblock ko_components %}
