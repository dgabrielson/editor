{% extends "question/edit.html" %}
{% load user_link %}

{% block editor %}
	<div class="tab-content">
		<section class="tab-pane" data-bind="css: {active: ko.utils.unwrapObservable($root.currentTab().id)=='general'}">
			<div class="row-fluid section">
				<label>
					<h4>Question Name <helplink params="topic: 'question name', url: 'http://numbas-editor.readthedocs.org/en/latest/question-reference.html#term-question-name'"></helplink></h4>
					<input class="input-block-level" id="question-name" data-bind="textInput: name" type="text"/>
				</label>
			</div>
			<div class="row-fluid section">
				<div class="span8">
					<p><span class="question-author">Question Author:</span> {% user_link object.author %}</p>
                    <p class="editable-message">You can edit this question.</p>
                    {% if object.copy_of %}
                    <p>This question is based on <a href="{% url 'question_edit' object.copy_of.pk object.copy_of.slug %}">{{object.copy_of.name}}</a> by <a href="{% url 'view_profile' object.copy_of.author.pk %}">{{object.copy_of.author.get_full_name}}</a>.</p>
                    {% endif %}
				</div>
				<div class="span4">
					{% if perms.editor.question_highlight %}
					<a href="{% url 'highlight_question' object.pk object.slug %}">Highlight this question on the front page.</a>
					{% endif %}
				</div>
			</div>
			<div class="row-fluid section">
				<div class="span8">
					<label for="description"><h4>Description <helplink params="topic: 'description', url: 'http://numbas-editor.readthedocs.org/en/latest/question-reference.html#term-description'"></helplink></h4></label>
					<writemaths id="description" params="value: description"></writemaths>
					<div data-bind="if: !description()" class="nothing-here">The author has not written a description.</div>
					<label for="authors-notes"><h4>Author's Notes <helplink params="topic: 'author\'s notes', url: 'http://numbas-editor.readthedocs.org/en/latest/question-reference.html#term-author-s-notes'"></helplink></h4></label>
					<writemaths id="authors-notes" params="value: notes"></writemaths>
					<div data-bind="if:!notes()" class="nothing-here">The author has not made any notes.</div>
				</div>
				<div class="span4">
					<h4>Extensions <helplink params="topic: 'extensions', url: 'http://numbas-editor.readthedocs.org/en/latest/question-reference.html#term-extensions'"></helplink></h4>
					<ul class="extensions" data-bind="foreach: extensions">
						<li class="extension">
							<label>
								<input type="checkbox" data-bind="checked: used">
								<span data-bind="text:name"></span> <a data-bind="attr: {href:url}" target="_blank">(documentation)</a>
							</label>
						</li>
					</ul>
					<div class="tags">
						<h4>Tags <helplink params="topic: 'tags', url: 'http://numbas-editor.readthedocs.org/en/latest/question-reference.html#term-tags'"></helplink></h4>
						<form data-bind="submit: function(form) {var input = $(form).find('input');$data.tags.push(input.val());input.val('').focus();}">
							<input type="text"></input>
						</form>
						<ul class="tags" data-bind="foreach: tags">
							<li class="tag well">
							<a data-bind="attr: {href: '{% url 'question_search' %}?tags='+encodeURIComponent($data), title:'Questions with the tag \''+$data+'\''}, text: $data" target="_blank"></a>
								<button type="button" class="delete" data-bind="click: $root.tags.remove" title="Remove this tag"></button>
							</li>
						</ul>
					</div>
				</div>
			</div>
			<div class="row-fluid section">
				<div class="span8">
				</div>
				<div class="span4 tags">
				</div>
			</div>
		</section>
		<section class="tab-pane" data-bind="css: {active: ko.utils.unwrapObservable($root.currentTab().id)=='statement'}">
			<helplink params="topic: 'the question statement', url: 'http://numbas-editor.readthedocs.org/en/latest/question-reference.html#statement', big: true"></helplink>
			<writemaths params="value: statement, css: $root.preamble.css"></writemaths>
			<div class="nothing-here" data-bind="if:!statement()">No statement.</div>
		</section>
		<section class="tab-pane" data-bind="css: {active: ko.utils.unwrapObservable($root.currentTab().id)=='variables'}">
			<helplink params="topic: 'variables', url: 'http://numbas-editor.readthedocs.org/en/latest/question-reference.html#variables', big: true"></helplink>
			<div class="row-fluid">
				<div class="span4">
					<div>
						<div class="variable-groups" data-bind="foreach: allVariableGroups">
							<div class="variable-group" data-bind="css: {editable: !fixed}">
								<div class="group-name">
									<button type="button" title="Remove this group" class="delete" data-bind="visible: !fixed, click:remove"></button>
									<h4 data-bind="text: displayName,visible: fixed || $root.editVariableGroup()!=$data, event: {focus: fixed ? null : $root.editVariableGroup}, attr: {tabindex: fixed ? undefined : 0}"></h4>
									<form data-bind="submit: endEdit">
										<input data-bind="value:name, visible: $root.editVariableGroup()==$data, hasfocus: isEditing, event: {blur: endEdit}"/>
									</form>
								</div>
								<table class="variable-list">
									<thead>
										<tr>
											<th class="name">Name</th>
											<th class="value">Generated Value</th>
										</tr>
									</thead>
									<tbody data-bind="css: {empty: variables().length==0}, sortable: {
										template: 'variable-template',
										data: $data.variables,
										options: {
											forcePlaceholderSize: true,
											placeholder: 'placeholder'
										}
									}">
									</tbody>
								</table>

								<button type="button" class="add-variable" data-bind="click: addVariable, attr: {title: (variables().length ? 'Add another variable' : 'Add a variable')+' to '+name()}">
									<span class="icon"></span>
									Add a variable
								</button>
							</div>
						</div>
						<script type="text/html" id="variable-template">
							<tr data-bind="click: $root.currentVariable, css: {noname: !name(), current: $data==$root.currentVariable(), dependency: isDependency}" class="variable-selector">
								<td class="name" data-bind="text: name() ? name() : 'Unnamed'"></td>
								<td class="value-cell">
									<div class="value" data-bind="css: {error: error().length>0}, html: display"></div>
								</td>
								<td class="delete-cell">
									<button type="button" title="Remove this variable" class="delete" data-bind="click:remove"></button>
								</td>
							</tr>
						</script>
						<p>
							<label><input class="recalculate-checkbox" type="checkbox" data-bind="checked: autoCalculateVariables"/> Automatically regenerate variables when changes are made.</label>
						</p>
					</div>
					<button type="button" data-bind="click: addVariableGroup">New variable group</button>
					<button type="button" data-bind="click: computeVariables, visible: variables().length>0">Regenerate values</button>
				</div>
				<div class="span8 variable" data-bind="with: currentVariable">
					<form class="form-horizontal">
						<div class="control-group">
							<label>
								<span class="control-label">
									Name
									<helplink params="url: 'http://numbas-editor.readthedocs.org/en/latest/question-reference.html#term-name'"></helplink>
								</span>
								<div class="controls">
									<input type="text" placeholder="Name" class="name" data-bind="textInput: name, autosize: name"/>
									<span class="name-error" data-bind="text: nameError, visible: nameError"></span>
								</div>
							</label>
						</div>
						<div>
							<selectproperty params="
								label: 'Data type',
								property: templateType, 
								options: templateTypes, 
								optionsText: 'name', 
								helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-reference.html#term-data-type'
							"></selectproperty>
						</div>
						<div class="control-group">
							<label class="control-label">
								Value
								<helplink params="url: 'http://numbas-editor.readthedocs.org/en/latest/question-reference.html#term-value'"></helplink>
							</label>

							<div class="controls">
								<div data-bind="visible: templateType().id=='anything'">
									<textarea class="def" data-bind="valueUpdate: 'afterkeydown', codemirror: templateTypeValues.anything.definition, codemirrorMode: 'jme'"></textarea>
								</div>
								<div data-bind="visible: templateType().id=='number'">
									<input type="text" data-bind="textInput: templateTypeValues.number.value, autosize: {max: 500, min: 30, padding: 30, value: templateTypeValues.number.value}"/> (a number)
								</div>
								<div data-bind="visible: templateType().id=='range'">
									Numbers between 
									<input type="text" data-bind="textInput: templateTypeValues.range.min, autosize: {max: 500, min: 30, padding: 10, value: templateTypeValues.range.min}"/>
									and
									<input type="text" data-bind="textInput: templateTypeValues.range.max, autosize: {max: 500, min: 30, padding: 10, value: templateTypeValues.range.max}"/>
									(inclusive) with step size
									<input type="text" data-bind="textInput: templateTypeValues.range.step, autosize: {max: 500, min: 30, padding: 10, value: templateTypeValues.range.step}"/>
								</div>
								<div data-bind="visible: templateType().id=='randrange'">
									A random number between 
									<input type="text" data-bind="textInput: templateTypeValues.randrange.min, autosize: {max: 500, min: 30, padding: 10, value: templateTypeValues.randrange.min}"/>
									and
									<input type="text" data-bind="textInput: templateTypeValues.randrange.max, autosize: {max: 500, min: 30, padding: 10, value: templateTypeValues.randrange.max}"/>
									(inclusive) with step size
									<input type="text" data-bind="textInput: templateTypeValues.randrange.step, autosize: {max: 500, min: 30, padding: 10, value: templateTypeValues.randrange.step}"/>
								</div>
								<div data-bind="visible: templateType().id=='string'">
									<input type="text" data-bind="textInput: templateTypeValues.string.value, autosize: {max: 500, min: 30, padding: 10, value: templateTypeValues.string.value}"/> (text string)
								</div>
								<div data-bind="visible: templateType().id=='long string'">
									<writemaths params="value: templateTypeValues['long string'].value"></writemaths>
								</div>
								<div data-bind="visible: templateType().id=='list of numbers', with: templateTypeValues['list of numbers']">
									<input type="text" data-bind="textInput: commaValue, autosize: {max: 500, min: 30, padding: 10, value: commaValue}"/>
									(comma-separated list of numbers)
								</div>
								<div data-bind="visible: templateType().id=='list of strings', with: templateTypeValues['list of strings']">
									<ul class="no-bullets" data-bind="foreach: values.edit">
										<li>
										<input type="text" data-bind="textInput: value, event: {blur: onBlur}, autosize: {max: 500, min: 30, padding: 10, value: value}"/>
										</li>
									</ul>
									(text strings)
								</div>
							</div>
						</div>
						<div class="control-group">
							<label>
								<span class="control-label">
									Description
									<helplink params="url: 'http://numbas-editor.readthedocs.org/en/latest/question-reference.html#term-12'"></helplink>
								</span>
								<writemaths params="value: description"></writemaths>
							</label>
						</div>
					</form>
					<div data-bind="visible: dependencies().length>0" class="inline-names">
						<strong>Depends on:</strong>
						<ul data-bind="foreach: dependenciesObjects">
							<li><!-- ko if: $index()>0 -->, <!-- /ko --><span class="variable" data-bind="click: $root.currentVariable, text: name"></span></li>
						</ul>.
					</div>
					<div data-bind="visible: usedIn().length>0" class="inline-names">
						<strong>Used by:</strong>
						<ul data-bind="foreach: usedIn">
							<li><!-- ko if: $index()>0 -->, <!-- /ko --><span class="variable" data-bind="click: $root.currentVariable, text: name"></span></li>
						</ul>.
					</div>
				</div>
			</div>
		</section>
		<section class="tab-pane" data-bind="css: {active: ko.utils.unwrapObservable($root.currentTab().id)=='functions'}">
			<div id="functions">
				<h4>Functions <helplink params="topic: 'functions', url: 'http://numbas-editor.readthedocs.org/en/latest/question-reference.html#functions-rulesets'"></helplink></h4>
				<!-- ko foreach: {data: functions, afterAdd: Editor.afterAdd} -->
				<div class="function row-fluid">
					<div class="span1">
						<button type="button" class="delete" data-bind="click:remove" title="Delete this function"></button>
					</div>
					<div class="span8">
						<div class="row-fluid">
							<div class="span4">
								<label>
									Name <helplink params="topic: 'function names', url: 'http://numbas-editor.readthedocs.org/en/latest/question-reference.html#term-name'"></helplink>
									<div>
										<input placeholder="Name" type="text" data-bind="textInput: name, autosize: {value: name, max: 220}">
									</div>
								</label>
							</div>
							<div class="span4">
								<label>
									Language <helplink params="topic: 'languages', url: 'http://numbas-editor.readthedocs.org/en/latest/question-reference.html#term-language'"></helplink>
									<select data-bind="options: languages, value: language"></select>
								</label>
							</div>
							<div class="span4">
								<label>
									Output type <helplink params="topic: 'output data types', url: 'http://numbas-editor.readthedocs.org/en/latest/question-reference.html#term-output-type'"></helplink>
									<select data-bind="options: types, value:type"></select>
								</label>
							</div>
							<div>
								<label>
									Definition:
									<textarea data-bind="codemirror: definition, codemirrorMode: language, valueUpdate: 'afterkeydown'"></textarea>
								</label>
								<div class="error" data-bind="visible: error().length>0">
									Error: <span class="errortext" data-bind="html: error"></span>
								</div>
							</div>
						</div>
					</div>
					<div class="span3">
						<label>Parameters</label>
						<!-- ko foreach: {data: parameters, afterAdd: Editor.afterAdd} -->
						<div class="row-fluid parameter">
							<form class="form-inline">
								<input class="name" type="text" placeholder="Name" data-bind="textInput: name"/>
								<select class="type" data-bind="options: $parent.types, value: type"></select>
								<button type="button" class="delete" data-bind="click: remove" title="Remove this parameter"></button>
							</form>
						</div>
						<!-- /ko -->
						<button type="button" class="addparameter" data-bind="click:addParameter, text: parameters().length ? 'Add another parameter' : 'Add a parameter'"></button>
					</div>
				</div>
				<!-- /ko -->
				<button type="button" data-bind="click:addFunction, text: functions().length ? 'Add another function' : 'Add a function'"></button>
			</div>
			<div id="rulesets">
				<h4>Rulesets <helplink params="topic: 'rulesets', url: 'http://numbas-editor.readthedocs.org/en/latest/question-reference.html#rulesets'"></helplink></h4>
				<form class="form-horizontal">
					<!-- ko foreach: {data: rulesets, afterAdd: Editor.afterAdd} -->
						<div class="ruleset control-group">
							<span class="control-label">
								<input type="text" placeholder="Name" class="name control-label" data-bind="textInput: name"/>
							</span>
							<div class="controls">:
								<div class="rules" data-bind="listbox:sets, rulesetcomplete: allsets"></div>
								<button type="button" class="delete" data-bind="click:remove" title="Delete this ruleset"></button>
							</div>
						</div>
					<!-- /ko -->
					<button type="button" data-bind="click:addRuleset, text: rulesets().length ? 'Add another ruleset' : 'Add a ruleset'"></button>
				</form>
			</div>
			<div id="preamble">
				<h4>
					Preamble
					<helplink params="url: 'http://numbas-editor.readthedocs.org/en/latest/question-reference.html#preamble'"></helplink>
				</h4>
				<form class="form-horizontal">
					<div class="control-group">
						<label class="control-label">
							Javascript
						</label>
						<div class="controls">
							<textarea data-bind="valueUpdate: 'afterkeydown', codemirror: preamble.js, codemirrorMode: 'javascript'"></textarea>
						</div>
					</div>
					<div class="control-group">
						<label class="control-label">
							CSS
						</label>
						<div class="controls">
							<textarea data-bind="valueUpdate: 'afterkeydown', codemirror: preamble.css, codemirrorMode: 'css'"></textarea>
						</div>
					</div>
				</form>
			</div>
		</section>
		<section class="tab-pane" data-bind="css: {active: ko.utils.unwrapObservable($root.currentTab().id)=='parts'}">
			<div class="row-fluid">
				<div class="span3">
					<ol class="parts nav nav-list" data-bind="visible: parts().length>0, foreach: {data: parts, afterAdd: Editor.afterAdd}">
						<li class="part clearfix" data-bind="css: {active: $root.currentPart()==$data}">
							<div class="reorder" data-bind="visible: $root.currentPart()==$data && parentList().length>1">
								<button type="button" class="up" data-bind="click: moveUp, visible: canMove('up')" title="Move this part up one place"></button>
								<br/>
								<button type="button" class="down" data-bind="click: moveDown, visible: canMove('down')" title="Move this part down one place"></button>
							</div>
							<button type="button" class="delete" data-bind="click: remove" title="Delete this part"></button><a data-bind="text: header, click: $root.showPart" href="#"></a>
							<div class="subparts" data-bind="fadeVisible: meOrChildSelected">
								<div class="gaps" data-bind="if: type().name=='gapfill'">
									<h6>Gaps</h6>
									<ol class="gaps nav nav-list" data-bind="foreach: {data: gapfill.gaps, afterAdd: Editor.afterAdd}">
										<li class="part clearfix" data-bind="css: {active: $root.currentPart()==$data}">
											<div class="reorder" data-bind="visible: $root.currentPart()==$data && parentList().length>1">
												<button type="button" class="up" data-bind="click: moveUp, visible: canMove('up')" title="Move this part up one place"></button>
												<br/>
												<button type="button" class="down" data-bind="click: moveDown, visible: canMove('down')" title="Move this part down one place"></button>
											</div>
											<button type="button" class="delete" data-bind="click: remove" title="Delete this gap"></button><a data-bind="text: header, click: $root.showPart" href="#"></a>
										</li>
									</ol>
									<div class="addgap"><button type="button" data-bind="click:addGap, text: gapfill.gaps().length ? 'Add another gap' : 'Add a gap'"></button></div>
								</div>
								<div class="steps clearfix">
									<h6>Steps <helplink params="topic: 'steps', url: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-steps'"></helplink></h6>
									<ol class="steps nav nav-list" data-bind="foreach: {data: steps, afterAdd: Editor.afterAdd}">
										<li class="part clearfix" data-bind="css: {active: $root.currentPart()==$data}">
										<div class="reorder" data-bind="visible: $root.currentPart()==$data && parentList().length>1">
												<button type="button" class="up" data-bind="click: moveUp, visible: canMove('up')" title="Move this part up one place"></button>
												<br/>
												<button type="button" class="down" data-bind="click: moveDown, visible: canMove('down')" title="Move this part down one place"></button>
											</div>
											<button type="button" class="delete" data-bind="click: remove" title="Delete this step"></button><a data-bind="text: header, click: $root.showPart" href="#"></a>
										</li>
									</ol>
									<div class="addstep"><button type="button" data-bind="click:addStep, text: steps().length ? 'Add another step' : 'Add a step'"></button></div>
								</div>
							</div>
						</li>
					</ol>
					<button type="button" data-bind="click:addPart, text: parts().length ? 'Add another part' : 'Add a part'"></button>
				</div>
				<div class="span9 part-edit" data-bind="with: currentPart">
					<h4 class="header">
						Type: <select class="type" data-bind="options: availableTypes, value:type, optionsText: 'niceName'"></select> <helplink params="topic: 'part types', url: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html'"></helplink>
						<button class="copy-part" data-bind="click: copy">Copy this part</button>
					</h4>
					<div class="row-fluid">
						<ul class="nav nav-tabs" data-bind="foreach: tabs">
							<li data-bind="css: {active: ko.utils.unwrapObservable($parent.currentTab().id) == $data.id}">
								<a href="#" data-bind="click: $parent.currentTab, text: title"></a>
							</li>
						</ul>
					</div>
					<div class="row-fluid">
						<div class="tab-content">
							<section class="tab-pane" data-bind="css: {active: ko.utils.unwrapObservable(currentTab().id)=='prompt'}">
								<helplink params="topic: 'part prompt', url: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-prompt', big: true"></helplink>
								<writemaths params="value: prompt, css: $root.preamble.css"></writemaths>
							</section>
							<!-- ko if: type().name=='gapfill' -->
							<section class="tab-pane" data-bind="css: {active: ko.utils.unwrapObservable(currentTab().id)=='marking'}">
								<form class="form-horizontal">
									<property params="
												label: 'Penalty for revealing steps',
												value: stepsPenalty,
												min: 0,
												helpUrl: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-penalty-for-revealing-steps'
									"></property>
								</form>
							</section>
							<!-- /ko -->
							<!-- ko if: type().name=='jme' -->
							<section class="tab-pane" data-bind="css: {active: ko.utils.unwrapObservable(currentTab().id)=='marking'}">
								<form class="form-horizontal">
									<property params="
										label:'Marks',
										value: marks,
										min:0, 
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-marks'
									"></property>
									<property data-bind="visible: !parent" params="
										label:'Penalty for revealing steps',
										value: stepsPenalty,
										min:0, 
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-penalty-for-revealing-steps'
									"></property>
									<div class="control-group">
										<label>
											<span class="control-label">Correct answer <helplink params="url: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-correct-answer'"></helplink></span>
											<div class="controls">
												<input class="monospace" type="text" data-bind="textInput: jme.answer, autosize: {max: 500, min: 30, padding: 10, value: jme.answer}"/>
												<span data-bind="JME: jme.answer" class="jme-answer"></span>
											</div>
										</label>
									</div>
									<booleanproperty params="
										label: 'Show correct answer on reveal?',
										value: showCorrectAnswer,
										min:0, 
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-show-correct-answer-on-reveal'
									"></booleanproperty>
									<booleanproperty params="
										label: 'Show preview of student\'s answer?', 
										value: jme.showPreview, 
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-show-preview-of-student-s-answer'
									"></booleanproperty>
									<property params="
										label: 'Answer simplification rules',
										value: jme.answerSimplification, 
										monospace: true, 
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-answer-simplification-rules'
									"></property>
								</form>
							</section>
							<section class="tab-pane" data-bind="css: {active: ko.utils.unwrapObservable(currentTab().id)=='restrictions'}">
								<form class="form-horizontal">
									<h4>Checking accuracy</h4>
									<selectproperty params="
										label: 'Checking type',
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-checking-type',
										options: jme.checkingTypes,
										value: jme.checkingType,
										optionsText: 'niceName'
									"></selectproperty>
									<property params="
										label: 'Checking accuracy',
										value: jme.checkingType().accuracy,
										min: 0,
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-checking-accuracy'
									"></property>
									<property params="
										label: 'Points to check',
										value: jme.vset.points,
										min:0, 
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-points-to-check'
									"></property>
									<property params="
										label: 'Maximum no. of failures',
										value: jme.failureRate,
										min:0, 
										max:jme.vset.points, 
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-maximum-no-of-failures'
									"></property>
									<property params="
										label: 'Checking range start',
										value :jme.vset.start,
										max: jme.vset.end, 
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-checking-range-start'
									"></property>
									<property params="
										label: 'Checking range end',
										value: jme.vset.end,
										min:jme.vset.start, 
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-checking-range-end'
									"></property>
								</form>
								<h4>Length restriction</h4>
								<form class="form-horizontal">
									<property params="
										label: 'Maximum length',
										value: jme.maxlength.length,
										min:0, 
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-maximum-length-restriction'
									"></property>
									<div data-bind="fadeVisible: jme.maxlength.length()>0">
										<percentproperty params="
											label: 'Partial credit for long answer',
											value: jme.maxlength.partialCredit
										"></percentproperty>
										<div class="control-group">
											<label>
												<span class="control-label">Warning message</span>
												<div class="controls"><writemaths params="value: jme.maxlength.message, css: $root.preamble.css"></writemaths></div>
											</label>
										</div>
									</div>
								</form>
								<form class="form-horizontal">
									<property params="
										label: 'Minimum length',
										value: jme.minlength.length,
										min:0, 
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-minimum-length-restriction'
									"></property>
									<div data-bind="fadeVisible: jme.minlength.length()>0">
										<percentproperty params="
											label: 'Partial credit for short answer',
											value:jme.minlength.partialCredit
										"></percentproperty>
										<div class="control-group">
											<label>
												<span class="control-label">Warning message</span>
												<div class="controls"><writemaths params="value: jme.minlength.message, css: $root.preamble.css"></writemaths></div>
											</label>
										</div>
									</div>
								</form>
								<h4>String restriction</h4>
								<form class="form-horizontal">
									<listbox params="
										label: 'Required strings',
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-required-strings',
										value: jme.musthave.strings
									"></listbox>
									<div data-bind="fadeVisible: jme.musthave.strings().length>0">
										<percentproperty params="
											label: 'Partial credit for not using all required strings',
											value: jme.musthave.partialCredit
										"></percentproperty>
										<booleanproperty params="
											label: 'Show required strings in warning?', 
											value: jme.musthave.showStrings
										"></booleanproperty>
										<div class="control-group">
											<label>
												<span class="control-label">Warning message</span>
												<div class="controls"><writemaths params="value: jme.musthave.message, css: $root.preamble.css"></writemaths></div>
											</label>
										</div>
									</div>
								</form>

								<form class="form-horizontal">
									<listbox params="
										label: 'Forbidden strings',
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-forbidden-strings',
										value: jme.notallowed.strings
									"></listbox>
									<div data-bind="fadeVisible: jme.notallowed.strings().length>0">
										<percentproperty params="
											label: 'Partial credit for using any forbidden strings',
											value: jme.notallowed.partialCredit
										"></percentproperty>
										<booleanproperty params="
											label: 'Show required strings in warning?', 
											value: jme.notallowed.showStrings
										"></booleanproperty>
										<div class="control-group">
											<label>
												<span class="control-label">Warning message</span>
												<div class="controls"><writemaths params="value: jme.notallowed.message, css: $root.preamble.css"></writemaths></div>
											</label>
										</div>
									</div>
								</form>

								<form class="form-horizontal">
									<booleanproperty params="
										label: 'Warn if student uses an unexpected variable name?', 
										value: jme.checkVariableNames, 
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-warn-if-student-uses-an-unexpected-variable-name'
									"></booleanproperty>
									<listbox params="
										label: 'Expected variable names',
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-expected-variable-names',
										value: jme.expectedVariableNames
									"></listbox>
								</form>
							</section>
							<!-- /ko -->
							<!-- ko if: type().name=='numberentry' -->
							<section class="tab-pane" data-bind="css: {active: ko.utils.unwrapObservable(currentTab().id)=='marking'}">
								<form class="form-horizontal">
									<property params="
										label: 'Marks',
										value: marks,
										min:0, 
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-marks'
									"></property>
									<property params="
										label: 'Penalty for revealing steps',
										value: stepsPenalty, 
										min:0, 
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-penalty-for-revealing-steps'
									"></property>
									<property params="
										label: 'Minimum accepted value',
										value: numberentry.minValue, 
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-minimum-accepted-value'
									"></property>
									<property params="
										label: 'Maximum accepted value',
										value: numberentry.maxValue, 
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-maximum-accepted-value'
									"></property>
									<booleanproperty params="
										label: 'Must the answer be an integer?', 
										value: numberentry.integerAnswer, 
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-must-the-answer-be-an-integer'
									"></booleanproperty>
									<booleanproperty params="
										label:'Show correct answer on reveal?',
										value: showCorrectAnswer,
										min:0, 
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-show-correct-answer-on-reveal'
									"></booleanproperty>
									<div data-bind="fadeVisible: numberentry.integerAnswer"><percentproperty params="
										label: 'Partial credit for non-integer answer',
										value: numberentry.integerPartialCredit
									"></percentproperty></div>
									<selectproperty params="
										label: 'Precision restriction',
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-precision-restriction',
										options: numberentry.precisionTypes, 
										value: numberentry.precisionType, 
										optionsText: 'niceName'
									"></selectproperty>
									<div data-bind="fadeVisible: numberentry.precisionType().name!='none'"><property params="
										label: numberentry.precisionWord,
										value: numberentry.precision
									"></property></div>
									<div data-bind="fadeVisible: numberentry.precisionType().name!='none'"><booleanproperty params="
										label: 'Require trailing zeroes?',
										value: numberentry.strictPrecision, 
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-require-trailing-zeroes'
									"></booleanproperty></div>
									<div data-bind="fadeVisible: numberentry.precisionType().name!='none'"><percentproperty params="
										label: 'Partial credit for wrong precision',
										value: numberentry.precisionPartialCredit
									"></percentproperty></div>
									<div class="control-group" data-bind="fadeVisible: numberentry.precisionType().name!='none'">
										<label>
											<span class="control-label">Message if wrong precision</span>
											<div class="controls"><writemaths params="value: numberentry.precisionMessage, css: $root.preamble.css"></writemaths></div>
										</label>
									</div>
								</form>
							</section>
							<!-- /ko -->
							<!-- ko if: type().name=='patternmatch' -->
							<section class="tab-pane" data-bind="css: {active: ko.utils.unwrapObservable(currentTab().id)=='marking'}">
								<form class="form-horizontal">
									<property params="
										label: 'Marks',
										value: marks,
										min: 0, 
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-marks'
									"></property>
									<property data-bind="visible: !parent" params="
										label: 'Penalty for revealing steps',
										value: stepsPenalty,
										min: 0, 
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-penalty-for-revealing-steps'
									"></property>
									<property params="
										label: 'Answer pattern',
										value: patternmatch.answer, 
										monospace: true, 
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-answer-pattern'
									"></property>
									<booleanproperty params="
										label: 'Show correct answer on reveal?',
										value: showCorrectAnswer,
										min: 0, 
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-show-correct-answer-on-reveal'
									"></booleanproperty>
									<div data-bind="fadeVisible: showCorrectAnswer"><property params="
										label: 'Display answer',
										value: patternmatch.displayAnswer, 
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-display-answer'
									"></property></div>
									<booleanproperty params="
										label: 'Must the answer be in the correct case?', 
										value: patternmatch.caseSensitive, 
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-must-the-answer-be-in-the-correct-case'
									"></booleanproperty>
									<div data-bind="fadeVisible:patternmatch.caseSensitive"><percentproperty params="
										label: 'Partial credit for answer not matching case',
										value: patternmatch.partialCredit
									"></percentproperty></div>
								</form>
							</section>
							<!-- /ko -->
							<!-- ko if: type().name=='1_n_2' -->
							<section class="tab-pane" data-bind="css: {active: ko.utils.unwrapObservable(currentTab().id)=='marking'}">
								<form class="form-horizontal">
									<property params="
										label: 'Minimum marks',
										value: multiplechoice.minMarks, 
										max:multiplechoice.maxMarks, 
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-minimum-marks'
									"></property>
									<property params="
										label: 'Maximum marks',
										value: multiplechoice.maxMarks, 
										min:multiplechoice.minMarks, 
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-maximum-marks'
									"></property>
									<booleanproperty params="
										label: 'Show correct answer on reveal?',
										value: showCorrectAnswer,
										min:0, 
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-show-correct-answer-on-reveal'
									"></booleanproperty>
									<property params="
										label: 'Penalty for revealing steps',
										value: stepsPenalty,
										min:0, 
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-penalty-for-revealing-steps'
									"></property>
									<booleanproperty params="
										label: 'Shuffle order of choices?', 
										value: multiplechoice.shuffleChoices, 
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-shuffle-order-of-choices'
									"></booleanproperty>
									<div data-bind="fadeVisible: multiplechoice.displayType().name!='dropdown'"><property params="
										label: 'Number of display columns',
										value: multiplechoice.displayColumns, 
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-number-of-display-columns'
									"></property></div>
									<booleanproperty params="
										label: 'Custom marking matrix?', 
										value: multiplechoice.customMarking, 
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-custom-marking-matrix'
									"></booleanproperty>
									<div data-bind="fadeVisible: multiplechoice.customMarking"><property params="
										label: 'Custom matrix expression', 
										value: multiplechoice.customMatrix, 
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-custom-matrix-expression'
									"></property></div>
								</form>
							</section>
							<section class="tab-pane" data-bind="css: {active: ko.utils.unwrapObservable(currentTab().id)=='choices'}">
								<ul class="choices">
									<!-- ko foreach: {data: multiplechoice.choices, afterAdd: Editor.afterAdd} -->
									<li class="choice">
										<form class="form-inline">
											<button type="button" type="button" class="delete" data-bind="click:remove" title="Delete this choice"></button>
											<label>
												Marks:
												<input class="marks" type="text" data-bind="textInput: marks, autosize: {max: 500, min: 30, padding: 10, value: marks}"/>
											</label>
											<label>
												Distractor Message:
												<input type="text" data-bind="textInput: distractor, autosize: {max: 500, min: 100, padding: 10, value: distractor}"/>
											</label>
											<writemaths params="value: content, height: 100, width: 500, css: $root.preamble.css"></writemaths>
										</form>
									</li>
									<!-- /ko -->
									<li><button type="button" data-bind="click:addChoice">Add a choice</button></li>
								</ul>
							</section>
							<!-- /ko -->
							<!-- ko if: type().name=='m_n_2' -->
							<section class="tab-pane" data-bind="css: {active: ko.utils.unwrapObservable(currentTab().id)=='marking'}">
								<form class="form-horizontal">
									<property params="
										label: 'Minimum marks',
										value: multiplechoice.minMarks, 
										max:multiplechoice.maxMarks, 
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-minimum-marks'
									"></property>
									<property params="
										label: 'Maximum marks',
										value: multiplechoice.maxMarks, 
										min:multiplechoice.minMarks, 
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-maximum-marks'
									"></property>
									<booleanproperty params="
										label: 'Show correct answer on reveal?',
										value: showCorrectAnswer,
										min:0, 
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-show-correct-answer-on-reveal'
									"></booleanproperty>
									<property params="
										label: 'Penalty for revealing steps',
										value: stepsPenalty,
										min:0, 
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-penalty-for-revealing-steps'
									"></property>
									<property params="
										label: 'Minimum answers:',
										value: multiplechoice.minAnswers, 
										max:multiplechoice.maxAnswers,
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-minimum-answers'
									"></property>
									<property params="
										label: 'Maximum answers:',
										property: multiplechoice.maxAnswers, 
										min:multiplechoice.minAnswers,
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-maximum-answers'
									"></property>
									<booleanproperty params="
										label: 'Shuffle order of choices?', 
										value: multiplechoice.shuffleChoices, 
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-shuffle-order-of-choices'
									"></booleanproperty>
									<div data-bind="fadeVisible: multiplechoice.displayType().name!='dropdown'"><property params="
										label: 'Number of display columns',
										value: multiplechoice.displayColumns, 
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-number-of-display-columns'
									"></property></div>
									<booleanproperty params="
										label: 'Custom marking matrix?', 
										value: multiplechoice.customMarking, 
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-custom-marking-matrix'
									"></booleanproperty>
									<div data-bind="fadeVisible: multiplechoice.customMarking"><property params="
										label: 'Custom matrix expression', 
										value: multiplechoice.customMatrix, 
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-custom-matrix-expression'
									"></property></div>
								</form>
							</section>
							<section class="tab-pane" data-bind="css: {active: ko.utils.unwrapObservable(currentTab().id)=='choices'}">
								<ul class="choices">
									<!-- ko foreach: {data: multiplechoice.choices, afterAdd: Editor.afterAdd} -->
									<li class="choice">
										<form class="form-inline">
											<button type="button" class="delete" data-bind="click:remove" title="Delete this choice"></button>
											<label>
												Marks:
												<input class="marks" type="text" data-bind="textInput: marks, autosize: {max: 500, min: 30, padding: 10, value: marks}"/>
											</label>
											<label>
												Distractor Message:
												<input type="text" data-bind="textInput: distractor, autosize: {max: 500, min: 100, padding: 10, value: distractor}"/>
											</label>
											<writemaths params="value: content, height: 100, width: 500, css: $root.preamble.css"></writemaths>
										</form>
									</li>
									<!-- /ko -->
									<li><button type="button" data-bind="click:addChoice">Add a choice</button></li>
								</ul>
							</section>
							<!-- /ko -->
							<!-- ko if: type().name=='m_n_x' -->
							<section class="tab-pane" data-bind="css: {active: ko.utils.unwrapObservable(currentTab().id)=='marking'}">
								<form class="form-horizontal">
									<property params="
										label: 'Minimum marks',
										value: multiplechoice.minMarks, 
										max:multiplechoice.maxMarks, 
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-minimum-marks'
									"></property>
									<property params="
										label: 'Maximum marks',
										value: multiplechoice.maxMarks, 
										min:multiplechoice.minMarks, 
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-maximum-marks'
									"></property>
									<booleanproperty params="
										label: 'Show correct answer on reveal?',
										value: showCorrectAnswer,
										min:0, 
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-show-correct-answer-on-reveal'
									"></booleanproperty>
									<property params="
										label: 'Penalty for revealing steps',
										value: stepsPenalty,
										min:0, 
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-penalty-for-revealing-steps'
									"></property>
									<property params="
										label: 'Minimum answers:',
										value: multiplechoice.minAnswers, 
										max:multiplechoice.maxAnswers,
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-minimum-answers'
									"></property>
									<property params="
										label: 'Maximum answers:',
										property: multiplechoice.maxAnswers, 
										min:multiplechoice.minAnswers,
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-maximum-answers'
									"></property>
									<booleanproperty params="
										label: 'Shuffle order of choices?', 
										value: multiplechoice.shuffleChoices, 
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-shuffle-order-of-choices'
									"></booleanproperty>
									<booleanproperty params="
										label: 'Shuffle order of answers?',
										value: multiplechoice.shuffleAnswers, 
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-shuffle-order-of-answers'
									"></booleanproperty>
									<selectproperty params="
										label: 'Selection type',
										options: multiplechoice.displayTypes.m_n_x,
										value: multiplechoice.displayType,
										optionsText: 'niceName'
									"></selectproperty>
									<booleanproperty params="
										label: 'Custom marking matrix?', 
										value: multiplechoice.customMarking, 
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-custom-marking-matrix'
									"></booleanproperty>
									<div data-bind="fadeVisible: multiplechoice.customMarking"><property params="
										label: 'Custom matrix expression', 
										value: multiplechoice.customMatrix, 
										helpURL: 'http://numbas-editor.readthedocs.org/en/latest/question-parts.html#term-custom-matrix-expression'
									"></property></div>
								</form>
							</section>
							<section class="tab-pane" data-bind="css: {active: ko.utils.unwrapObservable(currentTab().id)=='choices'}">
								<div class="matrix">
									<label>Marking matrix:</label>
									<table class="multiplechoice">
										<thead>
											<tr>
												<td></td>
												<!-- ko foreach: {data: multiplechoice.answers, afterAdd: Editor.afterAdd} -->
													<th>
														<input type="text" data-bind="textInput: content">
														<button type="button" class="delete" data-bind="click:function(){this.remove()}" title="Delete this answer"></button>
													</th>
												<!-- /ko -->
												<td>
													<button type="button" data-bind="click:addAnswer">Add Answer</button>
												</td>
											</tr>
										</thead>
										<tbody>
											<!-- ko foreach: {data: multiplechoice.choices, afterAdd: Editor.afterAdd} -->
												<tr>
													<th>
														<input type="text" data-bind="textInput: content"/>
														<button type="button" class="delete" data-bind="click:remove" title="Delete this choice"></button>
													</th> 
													<!-- ko foreach: answers -->
														<td>
															<input type="text" class="marks monospace" data-bind="visible: !$parents[1].multiplechoice.customMarking(), textInput:  marks"/>
														</td>
													<!-- /ko -->
												</tr>
											<!-- /ko -->
											<tr><td><button type="button" data-bind="click:addChoice">Add Choice</button></td></tr>
										</tbody>
									</table>
								</div>
							</section>
							<!-- /ko -->
							<section class="tab-pane" data-bind="css: {active: ko.utils.unwrapObservable(currentTab().id)=='scripts'}">
								<form class="form-horizontal" data-bind="foreach: scripts">
									<div class="control-group">
										<label class="control-label">
											<span data-bind="text: displayName"></span><span data-bind="if: active"> (active)</span>
											<helplink params="topic: 'the advice section', url: helpURL"></helplink>
										</label>
										<div class="controls">
											<textarea data-bind="valueUpdate: 'afterkeydown', codemirror: script, codemirrorMode: 'javascript'"></textarea>
										</div>
									</div>
								</form>
							</section>
						</div>
					</div>
				</div>
			</div>
		</section>
		<section class="tab-pane" data-bind="css: {active: ko.utils.unwrapObservable($root.currentTab().id)=='advice'}">
			<helplink params="topic: 'the advice section', url: 'http://numbas-editor.readthedocs.org/en/latest/question-reference.html#advice', big: true"></helplink>
			<writemaths params="value:: advice, css: $root.preamble.css"></writemaths>
		</section>
		<section class="tab-pane" data-bind="css: {active: ko.utils.unwrapObservable($root.currentTab().id)=='resources'}">
			<helplink params="url: 'http://numbas-editor.readthedocs.org/en/latest/question-reference.html#resources', big: true"></helplink>
			<form data-bind="fileupload: resources" data-url="{% url 'upload_resource' object.pk object.slug %}">
				{% csrf_token %}
                <div class="control-group">
                    <label>
                        <h4 class="control-label">Upload an image</h4>
                        <div class="controls">
                            <input id="fileupload" type="file" name="files[]">
                        </div>
                    </label>
                </div>
			</form>
			<h4>Uploaded images</h4>
			<ul class="unstyled resources-list" data-bind="foreach: resources">
				<li class="resource clearfix">
					<div data-bind="visible: progress()<1" class="progress progress-striped active">
						<div class="bar" data-bind="style: {width: progress()+'%'}"></div>
					</div>
					<div data-bind="visible: progress()==1">
						<a data-bind="attr: {href: url}" target="_blank"><img class="thumbnail" data-bind="visible: filetype()=='img', attr: {src: url, title: name}"/></a>
						<span class="path" data-bind="text: 'resources/'+name()"></span>
						<button type="button" class="delete" data-bind="click: $root.deleteResource" title="Delete this image"></button>
					</div>
				</li>
			</ul>
		</section>
		<section class="tab-pane" data-bind="css: {active: ko.utils.unwrapObservable($root.currentTab().id)=='exams'}">
			{% if object.exam_set.count %}
				<ul class="exams-list">
				{% for exam in object.exam_set.all %}
					<li class="exam">
						<a href="{% url 'exam_edit' exam.pk exam.slug %}">{{exam.name}}</a> ({{ exam.author.get_full_name }})
					</li>
				{% endfor %}
				</ul>
			{% else %}
				This question is not used in any exams.
			{% endif %}
		</section>
		<section class="tab-pane" data-bind="css: {active: ko.utils.unwrapObservable($root.currentTab().id)=='access'}">
			<helplink params="url: 'http://numbas-editor.readthedocs.org/en/latest/question-reference.html#access', big: true"></helplink>
			<form class="form-horizontal">
				<div class="control-group">
					<label>
						<span class="control-label">Public visibility:</span>
						<div class="controls">
							<select data-bind="value: public_access, options: access_options, optionsText:'text',optionsValue:'value'"></select>
						</div>
					</label>
				</div>
			</form>
			<h4>Individual access rights</h4>
			<form class="form-horizontal" data-bind="submit: function(){}">
				<!-- ko foreach: {data: access_rights, afterAdd: Editor.afterAdd} -->
				<div class=control-group">
					<label>
						<span class="control-label" data-bind="text:name"></span>
						<div class="controls">
							<select data-bind="hasfocus: true, value: access_level, options: access_options, optionsText:'text',optionsValue:'value'"></select>
							<button type="button" class="delete" data-bind="click: remove" title="Remove this user's access"></button>
						</div>
					</label>
				</div>
				<!-- /ko -->
				<div class="control-group access-search">
					<label>
						<span class="control-label">Search for a user to give access to:</span>
						<div class="controls">
							<input id="search_author" type="text" size="30" data-bind="
								value: userAccessSearch,
								autocomplete: '{% url 'user_search' %}', 
								autocompleteCallback: function(user) { return {label: user.name, value: user.name} },
								autocompleteSelect: addUserAccess
								"/>
						</div>
					</label>
				</div>
			</form>
		</section>
	</div>

    <div class="modal hide fade" id="imagePickModal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h3>Insert image</h3>
        </div>
        <div class="modal-body">
			<form data-bind="fileupload: resources, afterupload: $root.insertImage" data-url="{% url 'upload_resource' object.pk object.slug %}">
				{% csrf_token %}
                <div class="control-group">
                    <label>
                        <span class="control-label">Upload an image</span>
                        <div class="controls">
                            <input id="fileupload" type="file" name="files[]">
                        </div>
                    </label>
                </div>
			</form>
            <ul class="unstyled resources-list" data-bind="foreach: resources">
				<li class="resource clearfix" data-bind="click: $root.insertImage">
					<img class="thumbnail" data-bind="visible: filetype()=='img', attr: {src: url, title: name}"/>
					<span data-bind="text: name"></span><span data-bind="visible: filetype()=='html'"> (will be embedded as an iframe)</span>
				</li>
            </ul>
        </div>
    </div>
    <div class="modal hide fade" id="imageAttributeModal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h3>Image attributes</h3>
        </div>
		<div class="modal-body">
			<form class="form-horizontal">
				<div class="control-group">
					<label>
						<span class="control-label">Width</span>
						<div class="controls">
							<input type="text" class="span1" data-bind="value: imageModal.width"> px
						</div>
					</label>
				</div>
				<div class="control-group">
					<label>
						<span class="control-label">Height</span>
						<div class="controls">
							<input type="text" class="span1" data-bind="value: imageModal.height"> px
						</div>
					</label>
				</div>
				<div class="control-group">
					<label>
						<span class="control-label">Title text</span>
						<div class="controls">
							<input type="text" data-bind="value: imageModal.title">
						</div>
					</label>
				</div>
				<div class="control-group">
					<label>
						<span class="control-label">Alt text</span>
						<div class="controls">
							<input type="text" data-bind="value: imageModal.alt">
						</div>
					</label>
				</div>
			</form>
		</div>
		<div class="modal-footer">
			<button type="button" class="btn" data-bind="click: function(){$('#imageAttributeModal').modal('hide');}">Cancel</button>
			<button type="button" class="btn btn-primary" data-bind="click: $root.changeImageAttributes">Apply</button>
		</div>
	</div>
    <div class="modal hide fade" id="iframeAttributeModal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h3>Embedded page attributes</h3>
        </div>
		<div class="modal-body">
			<form class="form-horizontal">
				<div class="control-group">
					<label>
						<span class="control-label">Width</span>
						<div class="controls">
							<input type="text" class="span1" data-bind="value: iframeModal.width"> px
						</div>
					</label>
				</div>
				<div class="control-group">
					<label>
						<span class="control-label">Height</span>
						<div class="controls">
							<input type="text" class="span1" data-bind="value: iframeModal.height"> px
						</div>
					</label>
				</div>
			</form>
		</div>
		<div class="modal-footer">
			<button type="button" class="btn" data-bind="click: function(){$('#iframeAttributeModal').modal('hide');}">Cancel</button>
			<button type="button" class="btn btn-primary" data-bind="click: $root.changeIframeAttributes">Apply</button>
		</div>
	</div>
{% endblock editor %}

{% block ko_components %}
	{{ block.super }}
	{% include "editable-components.html" %}
{% endblock ko_components %}
