{% extends "exam/edit.html" %}
{% load verbatim %}
{% load user_link %}

{% block editable_message %}You can edit this question.{% endblock %}

{% block editor %}
	{{ block.super }}

	<div class="tab-content">
		<section class="tab-pane" data-bind="css: {active: ko.utils.unwrapObservable($root.currentTab().id)=='general'}">
			<div class="row-fluid section">
				<label>
					<h4>Exam Name <helplink params="url: 'http://numbas-editor.readthedocs.org/en/latest/exam-reference.html#term-exam-name', topic: 'exam name'"></helplink></h4>
					<input class="input-block-level" id="exam-name" data-bind="value: name, valueUpdate: 'afterkeydown'" type="text"/>
				</label>
			</div>
			<div class="row-fluid section">
				<div class="span8">
					<p><span class="exam-author">Exam Author:</span> {% user_link object.author %}</p>
					<p class="editable-message">You can edit this exam.</p>
				</div>
				<div class="span4">
					{% if perms.editor.exam_highlight %}
					<a href="{% url 'highlight_exam' object.pk object.slug %}">Highlight this exam on the front page.</a>
					{% endif %}
				</div>
			</div>
            <div class="row-fluid section">
                <div class="span7">
                    <label for="description"><h4>Description  <helplink params="url: 'http://numbas-editor.readthedocs.org/en/latest/exam-reference.html#term-description', topic: 'description'"></helplink></h4></label>
					<div id="description"><writemaths params="value: description"></writemaths></div>
                    <label for="authors-notes"><h4>Author's Notes  <helplink params="url: 'http://numbas-editor.readthedocs.org/en/latest/exam-reference.html#term-author-s-notes', topic: 'author\'s notes'"></helplink></h4></label>
					<div id="authors-notes"><writemaths params="value: notes"></writemaths></div>
                </div>
				<div class="span4">
					<h4>Options</h4>
                    <form class="form-horizontal">
						<div class="control-group">
							<label>
								<span class="control-label">
									Interface theme
									<helplink params="url: 'http://numbas-editor.readthedocs.org/en/latest/exam-reference.html#term-theme'"></helplink>
								</span>
								<div class="controls">
									<select data-bind="options: Editor.themes, value: theme, optionsText: 'name'"></select>
								</div>
							</label>
						</div>
						<div class="control-group">
							<label>
								<span class="control-label">
									Interface language
									<helplink params="url: 'http://numbas-editor.readthedocs.org/en/latest/exam-reference.html#term-interface-language'"></helplink>
								</span>
								<div class="controls">
									<select data-bind="options: Editor.locales, value: locale, optionsValue: 'code', optionsText: 'name'"></select>
								</div>
							</label>
						</div>
						<percentproperty params="
							label: 'Pass threshold (percent)',
							value: percentPass, 
							helpURL: 'http://numbas-editor.readthedocs.org/en/latest/exam-reference.html#term-pass-threshold'
                        "></percentproperty>
                    </form>
                </div>
			</div>
		</section>
		<section class="tab-pane" data-bind="css: {active: ko.utils.unwrapObservable($root.currentTab().id)=='navigation'}">
			<form class="form-horizontal">
				<booleanproperty params="label: 'Allow user to regenerate questions?', value: allowregen, helpURL: 'http://numbas-editor.readthedocs.org/en/latest/exam-reference.html#term-allow-user-to-regenerate-questions'"></booleanproperty>
				<booleanproperty params="label: 'Allow move to previous question?', value: reverse, helpURL: 'http://numbas-editor.readthedocs.org/en/latest/exam-reference.html#term-allow-move-to-previous-question'"></booleanproperty>
				<booleanproperty params="label: 'Allow jump to any question?', value: browse, helpURL: 'http://numbas-editor.readthedocs.org/en/latest/exam-reference.html#term-allow-jump-to-any-question'"></booleanproperty>
				<booleanproperty params="label: 'Show front page?',value: showfrontpage, helpURL: 'http://numbas-editor.readthedocs.org/en/latest/exam-reference.html#term-show-front-page'"></booleanproperty>
				<booleanproperty params="label: 'Confirm before leaving the exam while it\'s running?',value: preventleave, helpURL: 'http://numbas-editor.readthedocs.org/en/latest/exam-reference.html#term-confirm-before-leaving-the-exam-while-it-s-running'"></booleanproperty>
				<div data-bind="template: {
					name: 'event',
					data: onleave
				}"></div>
			</form>
		</section>
		<section class="tab-pane" data-bind="css: {active: ko.utils.unwrapObservable($root.currentTab().id)=='timing'}">
			<form class="form-horizontal">
				<numberproperty params="label: 'Exam duration (minutes):',value: duration, type:'number',min:0, helpURL: 'http://numbas-editor.readthedocs.org/en/latest/exam-reference.html#term-exam-duration'"></numberproperty>
				<booleanproperty params="label: 'Allow pausing?',value: allowPause, helpURL: 'http://numbas-editor.readthedocs.org/en/latest/exam-reference.html#term-allow-pausing'"></booleanproperty>
				<div data-bind="template: {
					name: 'event',
					data: timeout
				}"></div>
				<div data-bind="template: {
					name: 'event',
					data: timedwarning
				}"></div>
			</form>
		</section>
		<section class="tab-pane" data-bind="css: {active: ko.utils.unwrapObservable($root.currentTab().id)=='feedback'}">
			<form class="form-horizontal">
				<booleanproperty params=" label: 'Show current score?', value: showactualmark, helpURL: 'http://numbas-editor.readthedocs.org/en/latest/exam-reference.html#term-show-current-score'"></booleanproperty>
				<booleanproperty params=" label: 'Show maximum score?', value: showtotalmark, helpURL: 'http://numbas-editor.readthedocs.org/en/latest/exam-reference.html#term-show-maximum-score'"></booleanproperty>
				<booleanproperty params=" label: 'Show answer state?', value: showanswerstate, helpURL: 'http://numbas-editor.readthedocs.org/en/latest/exam-reference.html#term-show-answer-state'"></booleanproperty>
				<booleanproperty params=" label: 'Allow reveal answer?', value: allowrevealanswer, helpURL: 'http://numbas-editor.readthedocs.org/en/latest/exam-reference.html#term-allow-reveal-answer'"></booleanproperty>
				<percentproperty params=" label: 'Advice threshold (percent)', value: advicethreshold, helpURL: 'http://numbas-editor.readthedocs.org/en/latest/exam-reference.html#term-advice-threshold'"></percentproperty>
			</form>
		</section>
		<section class="tab-pane" data-bind="css: {active: ko.utils.unwrapObservable($root.currentTab().id)=='questions'}">
			<div class="row-fluid">
			</div>
            <div class="questions row-fluid">
                <div class="span6">
                    <form class="form-horizontal">
                        <booleanproperty params="label: 'Shuffle questions?',value: shuffleQuestions, helpURL: 'http://numbas-editor.readthedocs.org/en/latest/exam-reference.html#term-shuffle-questions'"></booleanproperty>
                    </form>
                    <ul class="questionList" data-bind="
                        sortable: {
                            template: 'question', 
                            data: questions, 
                            afterMove: dropQuestion,
                            options: {handle: '.handle', placeholder: 'placeholder'}
                        }
                        "></ul>
                </div>
                <div class="span6">
                    <ul class="nav nav-tabs" data-bind="foreach: questionTabs">
                        <li data-bind="css: {active: $root.currentQuestionTab() == $data}">
                            <a href="#" data-bind="click: $root.currentQuestionTab, text: title"></a>
                        </li>
                    </ul>
                    <div class="tab-content">
                        <div class="tab-pane" data-bind="css: {active: ko.utils.unwrapObservable($root.currentQuestionTab().id)=='mine'}">
                            <ul class="results editlist big" data-bind="
                                template: {
                                    name: 'questionResult',
                                    foreach: recentQuestions,
                                }
                            "></ul>
                        </div>
                        <div class="tab-pane" data-bind="css: {active: ko.utils.unwrapObservable($root.currentQuestionTab().id)=='search'}">
                            <form class="form-horizontal" data-bind="submit: search.submit">
                                <div class="control-group">
                                    <label for="questionsearch">
                                        <span class="control-label">Search for questions:</span>
                                        <div class="controls">
                                            <div class="input-append">
                                                <input type="text" id="questionsearch" class="search" placeholder="Topic or question name" data-bind="
                                                    value: search.query, 
                                                    valueUpdate: 'afterkeydown'
                                                "/>
                                                <span class="add-on"><button type="submit" class="search" data-bind="css: {loading: search.searching}"></button></span>
                                            </div>
                                        </div>
                                    </label>
                                    <label for="questionsearchtags">
                                        <span class="control-label">Filter by tags:</span>
                                        <div class="controls">
                                            <input type="text" id="questionsearchtags" class="search" placeholder="Tags separated by commas" data-bind="
                                                value: search.tags, 
                                                valueUpdate: 'afterkeydown'
                                            "/>
                                        </div>
                                    </label>
                                </div>
                            </form>
                            <div class="searchBox">
                                <ul class="results editlist big" data-bind="
                                    template: {
                                        name: 'questionResult',
                                        foreach: search.results.all,
                                    }
                                "></ul>
                            </div>
                        </div>
                    </div>
                </div>
			</div>
		</section>
		<section class="tab-pane" data-bind="css: {active: ko.utils.unwrapObservable($root.currentTab().id)=='access'}">
			<helplink params="url: 'http://numbas-editor.readthedocs.org/en/latest/exam-reference.html#access', topic: 'access rights', big: true"></helplink>
			<form class="form-horizontal">
				<div class="control-group">
					<label>
						<span class="control-label">Public visibility:</span>
						<div class="controls">
							<select data-bind="value: public_access, options: access_options, optionsText:'text',optionsValue:'value'"></select>
						</div>
					</label>
				</div>
			</form>
			<h4>Individual access rights</h4>
			<form class="form-horizontal" data-bind="submit: function(){}">
				<!-- ko foreach: {data: access_rights, afterAdd: Editor.afterAdd} -->
				<div class=control-group">
					<label>
						<span class="control-label" data-bind="text:name"></span>
						<div class="controls">
							<select data-bind="hasfocus: true, value: access_level, options: access_options, optionsText:'text',optionsValue:'value'"></select>
							<button type="button" class="delete" data-bind="click: remove" title="Remove this user's access"></button>
						</div>
					</label>
				</div>
				<!-- /ko -->
				<div class="control-group access-search">
					<label>
						<span class="control-label">Search for a user to give access to:</span>
						<div class="controls">
							<input id="search_author" type="text" size="30" data-bind="
								value: userAccessSearch,
								autocomplete: '{% url 'user_search' %}', 
								autocompleteCallback: function(user) { return {label: user.name, value: user.name} },
								autocompleteSelect: addUserAccess
								"/>
						</div>
					</label>
				</div>
			</form>
		</section>
	</div>

	{% verbatim %}

	<script type="text/html" id="event">
		<h4><span data-bind="html:niceName"></span> <helplink params="url: helpURL"></helplink></h4>
		<selectproperty params="label: 'Action', value: action, options: actions, optionsText: 'niceName'"></selectproperty>
		<div class="control-group">
			<label data-bind="fadeVisible:action().name!='none'">
				<span class="control-label">Message:</span>
				<div class="controls"><writemaths params="value: message, wmHeight: 100, wmWidth: 500"></writemaths></div>
			</label>
		</div>
	</script>

	<script type="text/html" id="question">
		<li class="question clearAfter">
			<span class="handle"></span>
			<div class="controls">
				<a class="preview" data-bind="attr: {href: previewURL()}" target="_blank" title="Test run this question"></a>
				<button type="button" class="copy" data-bind="click:replaceWithCopy" title="Replace this question with a copy"></button>
				<button type="button" class="delete delete-grey" data-bind="click:remove" title="Delete this question"></button>
			</div>
			<div class="title">
				<span class="number" data-bind="text: ($index()+1)+'.'"/>
				<a data-bind="attr:{href: url}, text: name" target="_blank"></a>
			</div>
			<div class="description" data-bind="visible: description.length>0, html: description, mathjax: true"></div>
		</li>
	</script>

	<script type="text/html" id="questionResult">
		<li class="question questionResult">
			<span class="handle" data-bind="click: add"></span>
			<div class="controls">
				<a class="preview" data-bind="attr: {href: previewURL()}" target="_blank" title="Test run this question"></a>
			</div>
			<div class="title">
				<a data-bind="attr:{href: url}, text: name" target="_blank"></a>
			</div>
			<div class="author">
				(<span data-bind="text: author"></span>)
            </div>
            <div data-bind="attr: {class: 'progress-display '+progress}, text: progressDisplay"></div>
			<div class="description" data-bind="visible: description.length>0, html: description, mathjax: true"></div>
		</li>
	</script>
	{% endverbatim %}

{% endblock editor %}

{% block ko_components %}
	{{ block.super }}
	{% include "editable-components.html" %}
{% endblock ko_components %}
