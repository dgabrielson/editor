{% extends "exam/edit.html" %}
{% load sstatic %}
{% load verbatim %}
{% load user_link %}

{% block stylesheets %}
	{{ block.super }}
	<link rel="stylesheet" type="text/css" href="{% sstatic 'css/exam/noneditable.css' %}">
{% endblock stylesheets %}

{% block editable_message %}You may only view this question. {% if user.is_authenticated %}If you want to change something, make a copy.{% endif %}{% endblock editable_message %}

{% block editor %}
	{{ block.super }}

	<div class="tab-content">
		<section class="tab-pane" data-bind="css: {active: ko.utils.unwrapObservable($root.currentTab().id)=='general'}">
			<div class="row-fluid section">
				<div class="span8">
					<p><span class="exam-author">Exam Author:</span> {% user_link object.author %}</p>
					<p class="editable-message">
						You may only view this exam. {% if user.is_authenticated %}If you want to change something, make a copy.{% endif %}
					</p>
				</div>
				<div class="span4">

					{% if perms.editor.question_highlight %}
					<a href="{% url 'highlight_question' object.pk object.slug %}">Highlight this question on the front page.</a>
					{% endif %}
				</div>
			</div>
			<div class="row-fluid section">
				<h4>Options</h4>
				<form class="form-horizontal">
					<selectproperty params="label: 'Theme:', value: theme, options: Editor.themes, optionsText: 'niceName'"></selectproperty>

					<selectproperty params="label: 'Interface language:', value: locale, options: Editor.locales, optionsText: 'niceName'"></selectproperty>

					<percentproperty params="label: 'Pass threshold:',value: percentPass"></percentproperty>
				</form>
			</div>
			<div class="row-fluid">
				<div class="span6">
					<label for="description"><h4>Description</h4></label>
					<div id="description" data-bind="mathjaxHTML: description"></div>
					<div data-bind="if: !description()" class="nothing-here">The author has not written a description.</div>
				</div>
				<div class="span6">
					<label for="authors-notes"><h4>Author's Notes</h4></label>
					<div id="authors-notes" data-bind="mathjaxHTML: notes"></div>
					<div data-bind="if:!notes()" class="nothing-here">The author has not made any notes.</div>
				</div>
			</div>
		</section>
		<section class="tab-pane" data-bind="css: {active: ko.utils.unwrapObservable($root.currentTab().id)=='navigation'}">
			<form class="form-horizontal">
				<booleanproperty params="label: 'Allow user to regenerate questions?', value: allowregen"></booleanproperty>
				<booleanproperty params="label: 'Allow move to previous question?', value: reverse"></booleanproperty>
				<booleanproperty params="label: 'Allow jump to any question?', value: browse"></booleanproperty>
				<booleanproperty params="label: 'Show front page?',value: showfrontpage"></booleanproperty>
				<booleanproperty params="label: 'Confirm before leaving the exam while it\'s running?',value: preventleave"></booleanproperty>
				<div data-bind="template: {
					name: 'event',
					data: onleave
				}"></div>
			</form>
		</section>
		<section class="tab-pane" data-bind="css: {active: ko.utils.unwrapObservable($root.currentTab().id)=='timing'}">
			<form class="form-horizontal">
				<numberproperty params="label: 'Exam duration (minutes):',value: duration, type:'number',min:0"></numberproperty>
				<booleanproperty params="label: 'Allow pausing?',value: allowPause"></booleanproperty>
				<div data-bind="template: {
					name: 'event',
					data: timeout
				}"></div>
				<div data-bind="template: {
					name: 'event',
					data: timedwarning
				}"></div>
			</form>
		</section>
		<section class="tab-pane" data-bind="css: {active: ko.utils.unwrapObservable($root.currentTab().id)=='feedback'}">
			<form class="form-horizontal">
				<booleanproperty params=" label: 'Show current score?', value: showactualmark"></booleanproperty>
				<booleanproperty params=" label: 'Show maximum score?', value: showtotalmark"></booleanproperty>
				<booleanproperty params=" label: 'Show answer state?', value: showanswerstate"></booleanproperty>
				<booleanproperty params=" label: 'Allow reveal answer?', value: allowrevealanswer"></booleanproperty>
				<percentproperty params=" label: 'Advice threshold (percent)', value: advicethreshold"></percentproperty>
			</form>
		</section>
		<section class="tab-pane" data-bind="css: {active: ko.utils.unwrapObservable($root.currentTab().id)=='questions'}">
			<div class="row-fluid">
				<form class="span6 form-horizontal">
					<booleanproperty params="label: 'Shuffle questions?',value: shuffleQuestions"></booleanproperty>
				</form>
			</div>
			<div class="questions row-fluid">
				<ul class="questionList span6" data-bind="visible: questions().length, foreach: questions">
					<li class="question clearAfter">
						<div class="controls">
							<a class="preview" data-bind="attr: {href: previewURL()}" target="_blank" title="Test run this question"></a>
						</div>
						<div class="title">
							<span class="number" data-bind="text: ($index()+1)+'.'"></span>
							<a data-bind="attr:{href: url}, text: name" target="_blank"></a>
						</div>
						<div class="description" data-bind="visible: description.length>0, html: description, mathjax: true"></div>
					</li>
                </ul>
				<div data-bind="if: questions().length==0" class="nothing-here">The author hasn't added any questions to this exam yet.</div>
			</div>
		</section>
	</div>

	{% verbatim %}

	<script type="text/html" id="event">
		<h4 data-bind="html:niceName"></h4>
		<div class="control-group">
			<label>
				<span class="control-label">Action:</span>
				<div class="controls">
					<span data-bind="text: action().niceName"></span>
				</div>
			</label>
		</div>
		<div class="control-group">
			<label data-bind="fadeVisible:action().name!='none'">
				<span class="control-label">Message:</span>
				<div class="controls" data-bind="mathjaxHTML: message, wmHeight: 100, wmWidth: 500"/>
			</label>
		</div>
	</script>

	<script type="text/html" id="question">
	</script>

	{% endverbatim %}

{% endblock editor %}

{% block ko_components %}
	{{ block.super }}
	{% include "noneditable-components.html" %}
{% endblock ko_components %}
